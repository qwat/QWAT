<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Header: /cvsroot/autodoc/autodoc/xml.tmpl,v 1.2 2006/05/16 19:01:27 rbt Exp $ -->

<book id="database.sige" xreflabel="sige database schema"><title>sige Model</title>




  <chapter id="distribution.schema"
           xreflabel="distribution">
    <title>Schema distribution</title>
    <para></para>


      <section id="distribution.table.dimension"
               xreflabel="distribution.dimension">
        <title id="distribution.table.dimension-title">
         Table:
         
         <structname>dimension</structname>
        </title>
 

        <para>
          dimension arcs displays measures done on the field. For example: distances to buildings corner
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>dimension</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>distance_observed</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distance_terrain</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lbl_x</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lbl_y</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lbl_a</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(MultiPoint,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on dimension</title>

          <varlistentry>
            <term>dimension_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.view.dimension-view"
               xreflabel="distribution.dimension_view">
        <title id="distribution.view.dimension-view-title">
         View:
         
         <structname>dimension_view</structname>
        </title>
 

        <para>
          Creates a Linestring so it can be viewed in QGIS as a curve. Later, this view should be remove and the new geometry transformed to CIRCULARSTRING.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>dimension_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>distance_observed</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distance_terrain</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lbl_x</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lbl_y</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>lbl_a</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view dimension_view</title>
         <programlisting>
SELECT dimension.id
, dimension.distance_observed
, dimension._distance_terrain
, dimension.lbl_x
, dimension.lbl_y
, dimension.lbl_a
, (st_curvetoline
     (st_geomfromewkt
           (
                 (
                       (
                             (
                                   (
                                         (
                                               (
                                                     (
                                                           (
                                                                 (
                                                                       (
                                                                             (
                                                                                   (
                                                              &apos;SRID=21781;CIRCULARSTRING(&apos;::text || st_x
                                                                                               (st_geometryn
                                                                                                     (dimension.geometry
                                                                                                           , 1
                                                                                                     )
                                                                                               )
                                                                                         ) || &apos; &apos;::text
                                                                                   ) || st_y
                                                                                   (st_geometryn
                                                                                         (dimension.geometry
                                                                                               , 1
                                                                                         )
                                                                                   )
                                                                             ) || 
                                                                           &apos;,&apos;::text
                                                                       ) || st_x
                                                                       (st_geometryn
                                                                             (dimension.geometry
                                                                                   , 2
                                                                             )
                                                                       )
                                                                 ) || &apos; &apos;::text
                                                           ) || st_y
                                                           (st_geometryn
                                                                 (dimension.geometry
                                                                       , 2
                                                                 )
                                                           )
                                                     ) || 
                                                   &apos;,&apos;::text
                                               ) || st_x
                                               (st_geometryn
                                                     (dimension.geometry
                                                           , 3
                                                     )
                                               )
                                         ) || &apos; &apos;::text
                                   ) || st_y
                                   (st_geometryn
                                         (dimension.geometry
                                               , 3
                                         )
                                   )
                             ) || 
                     &apos;)&apos;::text
                 )
           )
           , 12
     )
)::geometry
(LineString
     ,21781
) AS geometry 
FROM distribution.dimension;</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.distributor"
               xreflabel="distribution.distributor">
        <title id="distribution.table.distributor-title">
         Table:
         
         <structname>distributor</structname>
        </title>
 

        <para>
          Companies and distributors list.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>distributor</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank-cistern"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.district"
               xreflabel="distribution.district">
        <title id="distribution.table.district-title">
         Table:
         
         <structname>district</structname>
        </title>
 

        <para>
          Districts.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>district</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>shortname</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>zip</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>land_registry</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>subscriber_prefix</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Polygon,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on district</title>

          <varlistentry>
            <term>district_nooverlap</term>
            <listitem><para>CHECK ((st_overlaps(geometry, geometry) IS FALSE))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on district</title>

          <varlistentry>
            <term>district_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.samplingpoint"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.subscriber"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.valve"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.hydrant"
               xreflabel="distribution.hydrant">
        <title id="distribution.table.hydrant-title">
         Table:
         
         <structname>hydrant</structname>
        </title>
 

        <para>
          hydrant.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>hydrant</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>character varying(15)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.hydrant-type"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.distributor"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.status"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_provider</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.hydrant-provider"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>model</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.node"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.district"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pressurezone"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry_schematic</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on hydrant</title>

          <varlistentry>
            <term>hydrant_year_check</term>
            <listitem><para>CHECK (((year &gt; 1800) AND (year &lt; 2100)))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on hydrant</title>

          <varlistentry>
            <term>fki_hydrant_id_distributor</term>
            <listitem><para>id_distributor</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_hydrant_id_district</term>
            <listitem><para>id_district</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_hydrant_id_node</term>
            <listitem><para>id_node</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_hydrant_id_pressurezone</term>
            <listitem><para>id_pressurezone</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_hydrant_id_provider</term>
            <listitem><para>id_provider</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_hydrant_id_status</term>
            <listitem><para>id_status</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_hydrant_id_type</term>
            <listitem><para>id_type</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>hydrant_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>hydrant_geoidx_sch</term>
            <listitem><para>geometry_schematic</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.hydrant-provider"
               xreflabel="distribution.hydrant_provider">
        <title id="distribution.table.hydrant-provider-title">
         Table:
         
         <structname>hydrant_provider</structname>
        </title>
 

        <para>
          hydrant providers list.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>hydrant_provider</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.hydrant-type"
               xreflabel="distribution.hydrant_type">
        <title id="distribution.table.hydrant-type-title">
         Table:
         
         <structname>hydrant_type</structname>
        </title>
 

        <para>
          type for hydrant.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>hydrant_type</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>shortname</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.hydrant-view"
               xreflabel="distribution.hydrant_view">
        <title id="distribution.view.hydrant-view-title">
         View:
         
         <structname>hydrant_view</structname>
        </title>
 

        <para>
          View for hydrant. This view is editable (a rule exists to forwad changes to the table).
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>hydrant_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>character varying(15)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_provider</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>model</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distributor</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_provider</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_altitude_dtm</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district_shortname</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view hydrant_view</title>
         <programlisting>
SELECT hydrant.id
, hydrant.sige
, hydrant.id_type
, hydrant.id_distributor
, hydrant.id_status
, hydrant.id_provider
, hydrant.year
, hydrant.model
, hydrant.altitude_real
, hydrant.remarks
, hydrant.id_node
, hydrant.id_district
, hydrant.id_pressurezone
, hydrant.id_printmap
, hydrant._printmaps
, hydrant._districts
, hydrant.geometry
, hydrant_type.name AS _type
, distributor.name AS _distributor
, status.name AS _status_name
, status.active AS _status_active
, hydrant_provider.name AS _provider
, node.altitude_dtm AS _altitude_dtm
, district.name AS _district
, district.shortname AS _district_shortname
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode 
FROM (
     (
           (
                 (
                       (
                             (
                                   (distribution.hydrant 
                                      JOIN distribution.hydrant_type 
                                        ON (
                                               (hydrant.id_type = hydrant_type.id)
                                         )
                                   )
                                JOIN distribution.distributor 
                                  ON (
                                         (hydrant.id_distributor = distributor.id)
                                   )
                             )
                          JOIN distribution.status 
                            ON (
                                   (hydrant.id_status = status.id)
                             )
                       )
               LEFT JOIN distribution.hydrant_provider 
                      ON (
                             (hydrant.id_provider = hydrant_provider.id)
                       )
                 )
         LEFT JOIN distribution.node 
                ON (
                       (hydrant.id_node = node.id)
                 )
           )
   LEFT JOIN distribution.district 
          ON (
                 (hydrant.id_district = district.id)
           )
     )
LEFT JOIN distribution.pressurezone 
    ON (
           (hydrant.id_pressurezone = pressurezone.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.installation"
               xreflabel="distribution.installation">
        <title id="distribution.table.installation-title">
         Table:
         
         <structname>installation</structname>
        </title>
 

        <para>
          installation.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>installation</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>





                <literal>DEFAULT &apos;&apos;::character varying</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.status"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.distributor"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.installation-type"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>links</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>open_water_surface</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parcel</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eca</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.node"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.district"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pressurezone"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry_schematic</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on installation</title>

          <varlistentry>
            <term>installation_year_check</term>
            <listitem><para>CHECK (((year &gt; 1800) AND (year &lt; 2100)))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on installation</title>

          <varlistentry>
            <term>fki_installation_id_distributor</term>
            <listitem><para>id_distributor</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_id_district</term>
            <listitem><para>id_district</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_id_node</term>
            <listitem><para>id_node</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_id_pressurezone</term>
            <listitem><para>id_pressurezone</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_id_status</term>
            <listitem><para>id_status</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_id_type</term>
            <listitem><para>id_type</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>installation_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>installation_geoidx_sch</term>
            <listitem><para>geometry_schematic</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing installation_tank via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank-cistern"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.installation-tank"
               xreflabel="distribution.installation_tank">
        <title id="distribution.table.installation-tank-title">
         Table:
         
         <structname>installation_tank</structname>
        </title>
 

        <para>
          storage tanks. These are related to installations and are made of cisterns
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>installation_tank</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_installation</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.installation"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>





                <literal>DEFAULT &apos;&apos;::character varying</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.distributor"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.status"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>storage_total</structfield></term>
              <listitem><para>
                <type>numeric(10,1)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>storage_activ</structfield></term>
              <listitem><para>
                <type>numeric(10,1)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>storage_fire</structfield></term>
              <listitem><para>
                <type>numeric(10,1)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>height_max</structfield></term>
              <listitem><para>
                <type>numeric(7,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>litres_per_cm</structfield></term>
              <listitem><para>
                <type>numeric(7,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on installation_tank</title>

          <varlistentry>
            <term>fki_installation_tank_id_distributor</term>
            <listitem><para>id_distributor</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_tank_id_installation</term>
            <listitem><para>id_installation</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_tank_id_status</term>
            <listitem><para>id_status</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>installation_tank_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.installation-tank-cistern"
               xreflabel="distribution.installation_tank_cistern">
        <title id="distribution.table.installation-tank-cistern-title">
         Table:
         
         <structname>installation_tank_cistern</structname>
        </title>
 

        <para>
          storage tanks. These are related to installations and are made of cisterns
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>installation_tank_cistern</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_installation</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.installation"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>





                <literal>DEFAULT &apos;&apos;::character varying</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.distributor"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.status"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.installation-tank-cistern-type"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dimension_1</structfield></term>
              <listitem><para>
                <type>numeric(10,1)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dimension_2</structfield></term>
              <listitem><para>
                <type>numeric(10,1)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>storage</structfield></term>
              <listitem><para>
                <type>numeric(10,1)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>litres_per_cm</structfield></term>
              <listitem><para>
                <type>numeric(7,3)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on installation_tank_cistern</title>

          <varlistentry>
            <term>fki_installation_tank_cistern_id_distributor</term>
            <listitem><para>id_distributor</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_tank_cistern_id_installation</term>
            <listitem><para>id_installation</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_tank_cistern_id_status</term>
            <listitem><para>id_status</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_installation_tank_cistern_id_type</term>
            <listitem><para>id_type</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.installation-tank-cistern-type"
               xreflabel="distribution.installation_tank_cistern_type">
        <title id="distribution.table.installation-tank-cistern-type-title">
         Table:
         
         <structname>installation_tank_cistern_type</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>installation_tank_cistern_type</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>





                <literal>DEFAULT &apos;&apos;::character varying</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing installation_tank_cistern via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank-cistern"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.installation-type"
               xreflabel="distribution.installation_type">
        <title id="distribution.table.installation-type-title">
         Table:
         
         <structname>installation_type</structname>
        </title>
 

        <para>
          type for installation.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>installation_type</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>short_name</structfield></term>
              <listitem><para>
                <type>character varying(5)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing installation via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.installation"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.installation-view"
               xreflabel="distribution.installation_view">
        <title id="distribution.view.installation-view-title">
         View:
         
         <structname>installation_view</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>installation_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>links</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>open_water_surface</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parcel</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eca</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type_shortname</structfield></term>
              <listitem><para>
                <type>character varying(5)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distributor</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_altitude_dtm</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view installation_view</title>
         <programlisting>
SELECT installation.id
, installation.name
, installation.sige
, installation.id_status
, installation.id_distributor
, installation.remarks
, installation.links
, installation.year
, installation.altitude_real
, installation.open_water_surface
, installation.parcel
, installation.eca
, installation.id_node
, installation.id_district
, installation.id_pressurezone
, installation.id_printmap
, installation._printmaps
, installation._districts
, installation.geometry
, installation_type.name AS _type
, installation_type.short_name AS _type_shortname
, status.name AS _status
, status.active AS _status_active
, distributor.name AS _distributor
, CASE WHEN 
(installation.schema_force_view IS NULL) THEN installation_type.schema_view ELSE installation.schema_force_view END AS _schema_view
, node.altitude_dtm AS _altitude_dtm
, district.name AS _district
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode 
FROM (
     (
           (
                 (
                       (
                             (distribution.installation 
                                JOIN distribution.installation_type 
                                  ON (
                                         (installation.id_type = installation_type.id)
                                   )
                             )
                          JOIN distribution.status 
                            ON (
                                   (installation.id_status = status.id)
                             )
                       )
               LEFT JOIN distribution.distributor 
                      ON (
                             (installation.id_distributor = distributor.id)
                       )
                 )
         LEFT JOIN distribution.node 
                ON (
                       (installation.id_node = node.id)
                 )
           )
   LEFT JOIN distribution.district 
          ON (
                 (installation.id_district = district.id)
           )
     )
LEFT JOIN distribution.pressurezone 
    ON (
           (installation.id_pressurezone = pressurezone.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.node"
               xreflabel="distribution.node">
        <title id="distribution.table.node-title">
         Table:
         
         <structname>node</structname>
        </title>
 

        <para>
          Nodes. Type:If three pipe or more arrives at the node: three. If one pipe: one. If two: depends on characteristics of pipe: two_same (everything same), two_year (year is different), two_material (and year is/are different), two_diameter (and material/year are different). Orientation is calculated if two pipe arrives to place the symbol in theright direction.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>node</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_dtm</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>





                <literal>DEFAULT NULL::character varying</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_orientation</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on node</title>

          <varlistentry>
            <term>node_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.valve"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.node-control"
               xreflabel="distribution.node_control">
        <title id="distribution.view.node-control-title">
         View:
         
         <structname>node_control</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>node_control</structname>
            </title>


            <varlistentry>
              <term><structfield>problem</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>comment</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view node_control</title>
         <programlisting>
(
     (
           (
                 (
                       (
                        SELECT&apos;Node with undefined type&apos;::text AS problem
                             , node.id
                             ,&apos;node id&apos;::text AS comment 
                          FROM distribution.node 
                         WHERE (node._type IS NULL)
                         UNIONSELECT&apos;Node with no pipe/valve connected&apos;::text AS problem
                             , node.id
                             ,&apos;node id&apos;::text AS comment 
                          FROM distribution.node 
                         WHERE (
                                   (
                                         (NOT 
                                               (node.id IN 
                                                     (
                                                      SELECT DISTINCT pipe.id_node_a 
                                                        FROM distribution.pipe
                                                     )
                                               )
                                         )
                                       AND (NOT 
                                               (node.id IN 
                                                     (
                                                      SELECT DISTINCT pipe.id_node_b 
                                                        FROM distribution.pipe
                                                     )
                                               )
                                         )
                                   )
                                 AND (NOT 
                                         (node.id IN 
                                               (
                                                SELECT DISTINCT valve.id_node 
                                                  FROM distribution.valve
                                               )
                                         )
                                   )
                             )
                       )
                   UNIONSELECT&apos;Pipe with unreferenced node&apos;::text AS problem
                       , pipe.id
                       ,&apos;pipe id&apos;::text AS comment 
                    FROM distribution.pipe 
                   WHERE (
                             (NOT 
                                   (pipe.id_node_a IN 
                                         (
                                          SELECT node.id 
                                            FROM distribution.node
                                         )
                                   )
                             )
                           AND (NOT 
                                   (pipe.id_node_b IN 
                                         (
                                          SELECT node.id 
                                            FROM distribution.node
                                         )
                                   )
                             )
                       )
                 )
             UNIONSELECT&apos;Valve with unreferenced node&apos;::text AS problem
                 , valve.id
                 ,&apos;valve id&apos;::text AS comment 
              FROM distribution.valve 
             WHERE (NOT 
                       (valve.id_node IN 
                             (
                              SELECT node.id 
                                FROM distribution.node
                             )
                       )
                 )
           )
       UNIONSELECT&apos;Too close node&apos;::text AS problem
           , a.id
           , (
                 (
                       (
                             (
                                   (&apos;Distance: &apos;::text || 
                                         (st_distance
                                               (a.geometry
                                                     , b.geometry
                                               )
                                         )::numeric
                                         (6
                                               ,4
                                         )
                                   ) || &apos;Position: &apos;::text
                             ) || st_x
                             (a.geometry)
                       ) || &apos; &apos;::text
                 ) || st_y
                 (a.geometry)
           ) AS comment 
        FROM distribution.node a
           , distribution.node b 
       WHERE (
                 (a.id &lt;&gt; b.id)
               AND st_dwithin
                 (a.geometry
                       , b.geometry
                       , (0.004)::double precision
                 )
           )
     )
 UNIONSELECT&apos;Pipes without node(s)&apos;::text AS problem
, pipe.id
,&apos;pipe id&apos;::text AS comment 
FROM distribution.pipe 
WHERE (
     (pipe.id_node_a IS NULL)
    OR (pipe.id_node_b IS NULL)
)
)     
UNION SELECT&apos;Non up-to-date altitudes&apos;::text AS problem
,      (count
(node.id)
)     ::integer AS id
,     &apos;number of node&apos;::text AS comment 
FROM   distribution.node 
WHERE  (node.altitude_dtm IS NULL)
ORDER BY 1;</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.pipe"
               xreflabel="distribution.pipe">
        <title id="distribution.table.pipe-title">
         Table:
         
         <structname>pipe</structname>
        </title>
 

        <para>
          Table for pipe. This should not be used for editing/viewing, as a more complete view (pipe_view) exists.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_parent</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe-function"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_install_method</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe-install-method"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_material</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe-material"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.distributor"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_precision</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.precision"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_protection</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe-protection"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.status"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pressure_nominale</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>folder</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>





                <literal>DEFAULT &apos;&apos;::character varying</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_a</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.node"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_b</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.node"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.district"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pressurezone"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry_schematic</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>coating_internal_material_id</structfield></term>
              <listitem><para>
                <type>character(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>coating_external_material_id</structfield></term>
              <listitem><para>
                <type>character(20)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on pipe</title>

          <varlistentry>
            <term>pipe_year_check</term>
            <listitem><para>CHECK (((year &gt; 1800) AND (year &lt; 2100)))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pipe</title>

          <varlistentry>
            <term>fki_pipe_id_distributor</term>
            <listitem><para>id_distributor</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_district</term>
            <listitem><para>id_district</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_function</term>
            <listitem><para>id_function</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_install_method</term>
            <listitem><para>id_install_method</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_material</term>
            <listitem><para>id_material</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_node_a</term>
            <listitem><para>id_node_a</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_node_b</term>
            <listitem><para>id_node_b</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_parent</term>
            <listitem><para>id_parent</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_precision</term>
            <listitem><para>id_precision</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_pressurezone</term>
            <listitem><para>id_pressurezone</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_protection</term>
            <listitem><para>id_protection</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_pipe_id_status</term>
            <listitem><para>id_status</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pipe_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pipe_geoidx_sch</term>
            <listitem><para>geometry_schematic</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing pipe via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.subscriber"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.valve"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.pipe-child-parent"
               xreflabel="distribution.pipe_child_parent">
        <title id="distribution.view.pipe-child-parent-title">
         View:
         
         <structname>pipe_child_parent</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_child_parent</structname>
            </title>


            <varlistentry>
              <term><structfield>child</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parent</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_child_parent</title>
         <programlisting>
SELECT foo2.child
, foo2.parent
, (st_curvetoline
     (st_geomfromewkt
           (
                 (
                       (
                             (
                                   (
                                         (
                                               (
                                                     (
                                                           (
                                                                 (
                                                                       (
                                                                             (
                                                                                   (
                                                              &apos;SRID=21781;CIRCULARSTRING(&apos;::text || st_x
                                                                                               (foo2.start_point)
                                                                                         ) || &apos; &apos;::text
                                                                                   ) || st_y
                                                                                   (foo2.start_point)
                                                                             ) || 
                                                                           &apos;,&apos;::text
                                                                       ) || 
                                                                       (st_x
                                                                             (foo2.middle_point) + 
                                                                             (foo2.distance * cos
                                                                                   (foo2.azimuth)
                                                                             )
                                                                       )
                                                                 ) || &apos; &apos;::text
                                                           ) || 
                                                           (st_y
                                                                 (foo2.middle_point) + 
                                                                 (foo2.distance * sin
                                                                       (foo2.azimuth)
                                                                 )
                                                           )
                                                     ) || 
                                                   &apos;,&apos;::text
                                               ) || st_x
                                               (foo2.end_point)
                                         ) || &apos; &apos;::text
                                   ) || st_y
                                   (foo2.end_point)
                             ) || 
                     &apos;)&apos;::text
                 )
           )
           , 15
     )
)::geometry
(LineString
     ,21781
) AS geometry 
FROM (
SELECT foo.child
     , foo.parent
     , foo.start_point
     , foo.end_point
     , (
           (pi
                 () / 
                 (2)::double precision
           ) + st_azimuth
           (foo.start_point
                 , foo.end_point
           )
     ) AS azimuth
     , (
           (0.5)::double precision * st_distance
           (foo.start_point
                 , foo.end_point
           )
     ) AS distance
     , (st_line_interpolate_point
           (st_makeline
                 (foo.start_point
                       , foo.end_point
                 )
                 , (0.5)::double precision
           )
     )::geometry
     (Point
           ,21781
     ) AS middle_point 
  FROM (
      SELECT a.id AS child
           , b.id AS parent
           , (st_line_interpolate_point
                 (a.geometry
                       , (0.5)::double precision
                 )
           )::geometry
           (Point
                 ,21781
           ) AS start_point
           , st_closestpoint
           (st_makeline
                 (
                       (st_line_interpolate_point
                             (b.geometry
                                   , (LEAST
                                         (
                                               (1)::numeric
                                               , (
                                                     (
                                                           (4)::numeric / b._length2d
                                                     ) / 
                                                     (2)::numeric
                                               )
                                         )
                                   )::double precision
                             )
                       )::geometry
                       (Point
                             ,21781
                       )
                       , (st_line_interpolate_point
                             (b.geometry
                                   , (GREATEST
                                         (
                                               (0)::numeric
                                               , (
                                                     (1)::numeric - 
                                                     (
                                                           (
                                                                 (4)::numeric / b._length2d
                                                           ) / 
                                                           (2)::numeric
                                                     )
                                               )
                                         )
                                   )::double precision
                             )
                       )::geometry
                       (Point
                             ,21781
                       )
                 )
                 , a.geometry
           ) AS end_point 
        FROM (distribution.pipe a 
              JOIN distribution.pipe b 
                ON (
                       (a.id_parent = b.id)
                 )
           )
       WHERE (a.id_parent IS NOT NULL)
     ) foo
) foo2;</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.pipe-function"
               xreflabel="distribution.pipe_function">
        <title id="distribution.table.pipe-function-title">
         Table:
         
         <structname>pipe_function</structname>
        </title>
 

        <para>
          Function for pipe. Here is determined if pipe should be visible or not in the schematic view, but this can be overidden by the pipe attribute schema_force_view.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_function</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>function</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pipe via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.pipe-install-method"
               xreflabel="distribution.pipe_install_method">
        <title id="distribution.table.pipe-install-method-title">
         Table:
         
         <structname>pipe_install_method</structname>
        </title>
 

        <para>
          Installation methods.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_install_method</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pipe via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.pipe-material"
               xreflabel="distribution.pipe_material">
        <title id="distribution.table.pipe-material-title">
         Table:
         
         <structname>pipe_material</structname>
        </title>
 

        <para>
          List of materials for pipe. All the possible combinations material/diameter are listed in this table. _fancy_name is automatically generated by rules on insert and update. It is meant to be used in QGIS for the combo box of pipe.id_material
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_material</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>short_name</structfield></term>
              <listitem><para>
                <type>character varying(8)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>diameter</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>diameter_internal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>diameter_external</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_fancy_name</structfield></term>
              <listitem><para>
                <type>character varying(18)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pipe via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.pipe-protection"
               xreflabel="distribution.pipe_protection">
        <title id="distribution.table.pipe-protection-title">
         Table:
         
         <structname>pipe_protection</structname>
        </title>
 

        <para>
          Pipes prtoection details.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_protection</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pipe via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.pipe-schema"
               xreflabel="distribution.pipe_schema">
        <title id="distribution.view.pipe-schema-title">
         View:
         
         <structname>pipe_schema</structname>
        </title>
 

        <para>
          Final view for schema
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_parent</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_install_method</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_material</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_precision</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_protection</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pressure_nominale</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>folder</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_install_method</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_name</structfield></term>
              <listitem><para>
                <type>character varying(18)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_longname</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter_internal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distributor</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_precision</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_protection</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>number_of_pipe</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_schema</title>
         <programlisting>
SELECT pipe_view.id
, pipe_view.id_parent
, pipe_view.id_function
, pipe_view.id_install_method
, pipe_view.id_material
, pipe_view.id_distributor
, pipe_view.id_precision
, pipe_view.id_protection
, pipe_view.id_status
, pipe_view.id_pressurezone
, pipe_view.schema_force_view
, pipe_view.year
, pipe_view.pressure_nominale
, pipe_view.folder
, pipe_view.remarks
, pipe_view.id_printmap
, pipe_view._printmaps
, pipe_view.id_district
, pipe_view._districts
, pipe_view._function_name
, pipe_view._install_method
, pipe_view._material_name
, pipe_view._material_longname
, pipe_view._material_diameter
, pipe_view._material_diameter_internal
, pipe_view._distributor
, pipe_view._precision
, pipe_view._protection
, pipe_view._status_name
, pipe_view._status_active
, pipe_view._pressurezone
, pipe_view._pressurezone_shortname
, pipe_view._consummerzone
, pipe_view._pressurezone_colorcode
, pipe_view._schema_view
, pipe_schema_merged._length2d
, pipe_schema_merged._length3d
, pipe_schema_merged.number_of_pipe
, pipe_schema_merged.tunnel_or_bridge
, pipe_schema_merged._valve_count
, pipe_schema_merged._valve_closed
, pipe_schema_merged.geometry 
FROM (distribution.pipe_schema_merged 
  JOIN distribution.pipe_view 
    ON (
           (pipe_view.id = pipe_schema_merged.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.view.pipe-schema-error"
               xreflabel="distribution.pipe_schema_error">
        <title id="distribution.view.pipe-schema-error-title">
         View:
         
         <structname>pipe_schema_error</structname>
        </title>
 

        <para>
          Report IDs of parent pipe where pipe concatenation leads to a MultiLineString and not to a LineString.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema_error</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_schema_error</title>
         <programlisting>
SELECT foo.id 
FROM (
SELECT pipe_schema_items.groupid AS id
     , (st_multi
           (st_linemerge
                 (st_union
                       (pipe_schema_items.geometry)
                 )
           )
     )::geometry
     (MultiLineString
           ,21781
     ) AS geometry 
  FROM distribution.pipe_schema_items 
GROUP BY pipe_schema_items.groupid
) foo 
WHERE (geometrytype
     (st_collectionhomogenize
           (foo.geometry)
     ) &lt;&gt; &apos;LINESTRING&apos;::text
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.view.pipe-schema-items"
               xreflabel="distribution.pipe_schema_items">
        <title id="distribution.view.pipe-schema-items-title">
         View:
         
         <structname>pipe_schema_items</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema_items</structname>
            </title>


            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groupid</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_schema_items</title>
         <programlisting>
SELECT pipe_schema_viewableitems.geometry
, distribution.get_parent
(pipe_schema_viewableitems.id
     , pipe_schema_viewableitems.id_parent
) AS groupid
, pipe_schema_viewableitems._length2d
, pipe_schema_viewableitems._length3d
, pipe_schema_viewableitems.tunnel_or_bridge
, pipe_schema_viewableitems._valve_count
, pipe_schema_viewableitems._valve_closed 
FROM distribution.pipe_schema_viewableitems;</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.view.pipe-schema-merged"
               xreflabel="distribution.pipe_schema_merged">
        <title id="distribution.view.pipe-schema-merged-title">
         View:
         
         <structname>pipe_schema_merged</structname>
        </title>
 

        <para>
          Merging of pipe based on the group ID
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema_merged</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>number_of_pipe</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_schema_merged</title>
         <programlisting>
SELECT pipe_schema_items.groupid AS id
, (st_linemerge
     (st_union
           (pipe_schema_items.geometry)
     )
)::geometry
(LineString
     ,21781
) AS geometry
, count
(pipe_schema_items.groupid) AS number_of_pipe
, sum
(pipe_schema_items._length2d) AS _length2d
, sum
(pipe_schema_items._length3d) AS _length3d
, bool_or
(pipe_schema_items.tunnel_or_bridge) AS tunnel_or_bridge
, sum
(pipe_schema_items._valve_count) AS _valve_count
, bool_or
(pipe_schema_items._valve_closed) AS _valve_closed 
FROM distribution.pipe_schema_items 
GROUP BY pipe_schema_items.groupid;</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.view.pipe-schema-node"
               xreflabel="distribution.pipe_schema_node">
        <title id="distribution.view.pipe-schema-node-title">
         View:
         
         <structname>pipe_schema_node</structname>
        </title>
 

        <para>
          Final view for schema completed with node.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema_node</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_parent</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_install_method</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_material</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_precision</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_protection</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pressure_nominale</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>folder</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_install_method</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_name</structfield></term>
              <listitem><para>
                <type>character varying(18)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_longname</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter_internal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distributor</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_precision</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_protection</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>number_of_pipe</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_a</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_b</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_diff_elevation</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_slope</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_schema_node</title>
         <programlisting>
SELECT foo.id
, foo.id_parent
, foo.id_function
, foo.id_install_method
, foo.id_material
, foo.id_distributor
, foo.id_precision
, foo.id_protection
, foo.id_status
, foo.id_pressurezone
, foo.schema_force_view
, foo.year
, foo.pressure_nominale
, foo.folder
, foo.remarks
, foo.id_printmap
, foo._printmaps
, foo.id_district
, foo._districts
, foo._function_name
, foo._install_method
, foo._material_name
, foo._material_longname
, foo._material_diameter
, foo._material_diameter_internal
, foo._distributor
, foo._precision
, foo._protection
, foo._status_name
, foo._status_active
, foo._pressurezone
, foo._pressurezone_shortname
, foo._consummerzone
, foo._pressurezone_colorcode
, foo._schema_view
, foo._length2d
, foo._length3d
, foo.number_of_pipe
, foo.tunnel_or_bridge
, foo._valve_count
, foo._valve_closed
, foo.geometry
, foo.id_node_a
, foo.id_node_b
, CASE WHEN 
(foo.tunnel_or_bridge IS TRUE) THEN NULL::numeric ELSE abs
(
     (node_a.altitude_dtm - node_b.altitude_dtm)
) END AS _diff_elevation
, CASE WHEN 
(foo.tunnel_or_bridge IS TRUE) THEN NULL::numeric ELSE 
(abs
     (
           (node_a.altitude_dtm - node_b.altitude_dtm)
     ) / foo._length3d
) END AS _slope 
FROM (
     (
           (
            SELECT pipe_schema.id
                 , pipe_schema.id_parent
                 , pipe_schema.id_function
                 , pipe_schema.id_install_method
                 , pipe_schema.id_material
                 , pipe_schema.id_distributor
                 , pipe_schema.id_precision
                 , pipe_schema.id_protection
                 , pipe_schema.id_status
                 , pipe_schema.id_pressurezone
                 , pipe_schema.schema_force_view
                 , pipe_schema.year
                 , pipe_schema.pressure_nominale
                 , pipe_schema.folder
                 , pipe_schema.remarks
                 , pipe_schema.id_printmap
                 , pipe_schema._printmaps
                 , pipe_schema.id_district
                 , pipe_schema._districts
                 , pipe_schema._function_name
                 , pipe_schema._install_method
                 , pipe_schema._material_name
                 , pipe_schema._material_longname
                 , pipe_schema._material_diameter
                 , pipe_schema._material_diameter_internal
                 , pipe_schema._distributor
                 , pipe_schema._precision
                 , pipe_schema._protection
                 , pipe_schema._status_name
                 , pipe_schema._status_active
                 , pipe_schema._pressurezone
                 , pipe_schema._pressurezone_shortname
                 , pipe_schema._consummerzone
                 , pipe_schema._pressurezone_colorcode
                 , pipe_schema._schema_view
                 , pipe_schema._length2d
                 , pipe_schema._length3d
                 , pipe_schema.number_of_pipe
                 , pipe_schema.tunnel_or_bridge
                 , pipe_schema._valve_count
                 , pipe_schema._valve_closed
                 , pipe_schema.geometry
                 , distribution.node_get_id
                 (st_startpoint
                       (pipe_schema.geometry)
                       , true
                 ) AS id_node_a
                 , distribution.node_get_id
                 (st_endpoint
                       (pipe_schema.geometry)
                       , true
                 ) AS id_node_b 
              FROM distribution.pipe_schema
           ) foo 
   LEFT JOIN distribution.node node_a 
          ON (
                 (foo.id_node_a = node_a.id)
           )
     )
LEFT JOIN distribution.node node_b 
    ON (
           (foo.id_node_b = node_b.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.pipe-schema-temp"
               xreflabel="distribution.pipe_schema_temp">
        <title id="distribution.table.pipe-schema-temp-title">
         Table:
         
         <structname>pipe_schema_temp</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema_temp</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_parent</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_install_method</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_material</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_precision</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_protection</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pressure_nominale</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>folder</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_install_method</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_name</structfield></term>
              <listitem><para>
                <type>character varying(18)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_longname</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter_internal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distributor</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_precision</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_protection</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>number_of_pipe</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_a</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_b</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_diff_elevation</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_slope</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="distribution.view.pipe-schema-viewableitems"
               xreflabel="distribution.pipe_schema_viewableitems">
        <title id="distribution.view.pipe-schema-viewableitems-title">
         View:
         
         <structname>pipe_schema_viewableitems</structname>
        </title>
 

        <para>
          viewable pipe in the schematic view (before merge)
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_schema_viewableitems</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_parent</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_schema_viewableitems</title>
         <programlisting>
SELECT pipe.id
, pipe.id_parent
, pipe._length2d
, pipe._length3d
, pipe.tunnel_or_bridge
, pipe.geometry_schematic AS geometry
, pipe_view._valve_count
, pipe_view._valve_closed 
FROM (distribution.pipe 
  JOIN distribution.pipe_view 
    ON (
           (pipe.id = pipe_view.id)
     )
)
WHERE (
     (pipe_view._schema_view IS TRUE)
   AND (pipe_view._status_active IS TRUE)
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.view.pipe-view"
               xreflabel="distribution.pipe_view">
        <title id="distribution.view.pipe-view-title">
         View:
         
         <structname>pipe_view</structname>
        </title>
 

        <para>
          View for pipe. This view is editable (a rule exists to forwad changes to the table). 
		schema_view is a boolean to define if the pipe is visible in the schematic view. This field is usually determined by the pipe&apos;s function attribute schema_view,
		but it can be overridden by the pipe&apos;s attribute schema_force_view.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pipe_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_parent</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_install_method</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_material</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_distributor</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_precision</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_protection</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_status</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tunnel_or_bridge</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pressure_nominale</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>folder</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_a</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node_b</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length2d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_length3d</structfield></term>
              <listitem><para>
                <type>numeric(8,2)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(LineString,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_install_method</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_name</structfield></term>
              <listitem><para>
                <type>character varying(18)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_longname</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_material_diameter_internal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_distributor</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_precision</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_protection</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_status_active</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_diff_elevation</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_slope</structfield></term>
              <listitem><para>
                <type>numeric</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_count</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_valve_closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view pipe_view</title>
         <programlisting>
SELECT pipe.id
, pipe.id_parent
, pipe.id_function
, pipe.id_install_method
, pipe.id_material
, pipe.id_distributor
, pipe.id_precision
, pipe.id_protection
, pipe.id_status
, pipe.schema_force_view
, pipe.year
, pipe.tunnel_or_bridge
, pipe.pressure_nominale
, pipe.folder
, pipe.remarks
, pipe.id_node_a
, pipe.id_node_b
, pipe.id_district
, pipe.id_pressurezone
, pipe.id_printmap
, pipe._length2d
, pipe._length3d
, pipe._printmaps
, pipe._districts
, pipe.geometry
, pipe_function.function AS _function_name
, pipe_install_method.name AS _install_method
, pipe_material._fancy_name AS _material_name
, pipe_material.name AS _material_longname
, pipe_material.diameter AS _material_diameter
, pipe_material.diameter_internal AS _material_diameter_internal
, distributor.name AS _distributor
,&quot;precision&quot;.name AS _precision
, pipe_protection.name AS _protection
, status.name AS _status_name
, status.active AS _status_active
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode
, CASE WHEN 
(pipe.schema_force_view IS NULL) THEN pipe_function.schema_view ELSE pipe.schema_force_view END AS _schema_view
, CASE WHEN 
(pipe.tunnel_or_bridge IS TRUE) THEN 
(0)::numeric ELSE abs
(
     (node_a.altitude_dtm - node_b.altitude_dtm)
) END AS _diff_elevation
, CASE WHEN 
(pipe.tunnel_or_bridge IS TRUE) THEN NULL::numeric ELSE 
(abs
     (
           (node_a.altitude_dtm - node_b.altitude_dtm)
     ) / pipe._length3d
) END AS _slope
, distribution.pipe_count_valve
(pipe.id) AS _valve_count
, distribution.pipe_isclosed
(pipe.id) AS _valve_closed 
FROM (
     (
           (
                 (
                       (
                             (
                                   (
                                         (
                                               (
                                                     (distribution.pipe 
                                                        JOIN distribution.pipe_function 
                                                          ON (
                                                                 (pipe.id_function = pipe_function.id)
                                                           )
                                                     )
                                                  JOIN distribution.pipe_install_method 
                                                    ON (
                                                           (pipe.id_install_method = pipe_install_method.id)
                                                     )
                                               )
                                            JOIN distribution.pipe_material 
                                              ON (
                                                     (pipe.id_material = pipe_material.id)
                                               )
                                         )
                                      JOIN distribution.distributor 
                                        ON (
                                               (pipe.id_distributor = distributor.id)
                                         )
                                   )
                                JOIN distribution.&quot;precision&quot;
                                  ON (
                                         (pipe.id_precision = &quot;precision&quot;.id)
                                   )
                             )
                     LEFT JOIN distribution.pipe_protection 
                            ON (
                                   (pipe.id_protection = pipe_protection.id)
                             )
                       )
                    JOIN distribution.status 
                      ON (
                             (pipe.id_status = status.id)
                       )
                 )
         LEFT JOIN distribution.pressurezone 
                ON (
                       (pipe.id_pressurezone = pressurezone.id)
                 )
           )
   LEFT JOIN distribution.node node_a 
          ON (
                 (pipe.id_node_a = node_a.id)
           )
     )
LEFT JOIN distribution.node node_b 
    ON (
           (pipe.id_node_b = node_b.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.precision"
               xreflabel="distribution.precision">
        <title id="distribution.table.precision-title">
         Table:
         
         <structname>precision</structname>
        </title>
 

        <para>
          pressure &quot;precision&quot;.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>precision</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pipe via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.pressurezone"
               xreflabel="distribution.pressurezone">
        <title id="distribution.table.pressurezone-title">
         Table:
         
         <structname>pressurezone</structname>
        </title>
 

        <para>
          Pressure zones.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pressurezone</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Polygon,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pressurezone</title>

          <varlistentry>
            <term>pressurezone_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.samplingpoint"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.subscriber"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.valve"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.printmap"
               xreflabel="distribution.printmap">
        <title id="distribution.table.printmap-title">
         Table:
         
         <structname>printmap</structname>
        </title>
 

        <para>
          This table is used for polygons for predefined printable maps. short_name would be used as label string, and long_mame would be used in the print composer.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>printmap</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>short_name</structfield></term>
              <listitem><para>
                <type>character varying(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>long_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>template</structfield></term>
              <listitem><para>
                <type>character varying(50)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_east</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_north</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Polygon,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on printmap</title>

          <varlistentry>
            <term>printmap_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.protectionzone"
               xreflabel="distribution.protectionzone">
        <title id="distribution.table.protectionzone-title">
         Table:
         
         <structname>protectionzone</structname>
        </title>
 

        <para>
          protectionzones.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>protectionzone</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.protectionzone-type"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>validated</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>date</structfield></term>
              <listitem><para>
                <type>date</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>agent</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(MultiPolygon,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on protectionzone</title>

          <varlistentry>
            <term>fki_protectionzone_id_type</term>
            <listitem><para>id_type</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>protectionzone_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.protectionzone-type"
               xreflabel="distribution.protectionzone_type">
        <title id="distribution.table.protectionzone-type-title">
         Table:
         
         <structname>protectionzone_type</structname>
        </title>
 

        <para>
          type for hydrant.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>protectionzone_type</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(50)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>shortname</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing protectionzone via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.protectionzone"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.samplingpoint"
               xreflabel="distribution.samplingpoint">
        <title id="distribution.table.samplingpoint-title">
         Table:
         
         <structname>samplingpoint</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>samplingpoint</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.district"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pressurezone"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on samplingpoint</title>

          <varlistentry>
            <term>fki_samplingpoint_id_district</term>
            <listitem><para>id_district</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_samplingpoint_id_pressurezone</term>
            <listitem><para>id_pressurezone</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>samplingpoint_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.view.samplingpoint-view"
               xreflabel="distribution.samplingpoint_view">
        <title id="distribution.view.samplingpoint-view-title">
         View:
         
         <structname>samplingpoint_view</structname>
        </title>
 

        <para>
          View for samplingpoint. This view is editable (a rule exists to forwad changes to the table).
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>samplingpoint_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view samplingpoint_view</title>
         <programlisting>
SELECT samplingpoint.id
, samplingpoint.sige
, samplingpoint.id_district
, samplingpoint.id_printmap
, samplingpoint.id_pressurezone
, samplingpoint._printmaps
, samplingpoint._districts
, samplingpoint.remarks
, samplingpoint.geometry
, district.name AS _district
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode 
FROM (
     (distribution.samplingpoint 
   LEFT JOIN distribution.district 
          ON (
                 (samplingpoint.id_district = district.id)
           )
     )
LEFT JOIN distribution.pressurezone 
    ON (
           (samplingpoint.id_pressurezone = pressurezone.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.view.search-view"
               xreflabel="distribution.search_view">
        <title id="distribution.view.search-view-title">
         View:
         
         <structname>search_view</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>search_view</structname>
            </title>


            <varlistentry>
              <term><structfield>layer_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>search_text</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view search_view</title>
         <programlisting>
(
     (
      SELECT&apos;Ouvrage&apos;::text AS layer_name
           , (
                 (
                       (installation_view._type)::text || &apos; &apos;::text
                 ) || 
                 (installation_view.name)::text
           ) AS search_text
           , installation_view.geometry 
        FROM distribution.installation_view 
       WHERE (installation_view._status_active IS TRUE)
       UNIONSELECT&apos;Hydrantes&apos;::text AS layer_name
           , (
                 (
                       (hydrant_view._district)::text || &apos; &apos;::text
                 ) || 
                 (hydrant_view.sige)::text
           ) AS search_text
           , hydrant_view.geometry 
        FROM distribution.hydrant_view 
       WHERE (hydrant_view._status_active IS TRUE)
     )
 UNIONSELECT&apos;Abonns&apos;::text AS layer_name
     , (
           (
                 (subscriber_view._type)::text || &apos; &apos;::text
           ) || subscriber_view.id_client_full
     ) AS search_text
     , subscriber_view.geometry 
  FROM distribution.subscriber_view
)
UNIONSELECT&apos;Vannes&apos;::text AS layer_name
, (
     (
           (valve_view._function)::text || &apos; &apos;::text
     ) || valve_view.sige
) AS search_text
, valve_view.geometry 
FROM distribution.valve_view 
WHERE (valve_view.sige IS NOT NULL);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.status"
               xreflabel="distribution.status">
        <title id="distribution.table.status-title">
         Table:
         
         <structname>status</structname>
        </title>
 

        <para>
          Status table, with SIRE id.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>status</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>active</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sire</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>comment</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing hydrant via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.hydrant"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.installation-tank-cistern"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="distribution.table.pipe"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.subscriber"
               xreflabel="distribution.subscriber">
        <title id="distribution.table.subscriber-title">
         Table:
         
         <structname>subscriber</structname>
        </title>
 

        <para>
          Table for subscriber. This should not be used for editing/viewing, as a more complete view (subscriber_view) exists.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>subscriber</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.subscriber-type"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pipe</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_client</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parcel</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.district"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pressurezone"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on subscriber</title>

          <varlistentry>
            <term>fki_id_pipe</term>
            <listitem><para>id_pipe</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_id_type</term>
            <listitem><para>id_type</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_subscriber_id_district</term>
            <listitem><para>id_district</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_subscriber_id_pressurezone</term>
            <listitem><para>id_pressurezone</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>subscriber_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.subscriber-type"
               xreflabel="distribution.subscriber_type">
        <title id="distribution.table.subscriber-type-title">
         Table:
         
         <structname>subscriber_type</structname>
        </title>
 

        <para>
          type for subscriber.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>subscriber_type</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>short_name</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing subscriber via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.subscriber"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.subscriber-view"
               xreflabel="distribution.subscriber_view">
        <title id="distribution.view.subscriber-view-title">
         View:
         
         <structname>subscriber_view</structname>
        </title>
 

        <para>
          View for subscriber. This view is editable (a rule exists to forward changes to the table).
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>subscriber_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pipe</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_client</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parcel</structfield></term>
              <listitem><para>
                <type>character varying(12)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_client_full</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view subscriber_view</title>
         <programlisting>
SELECT subscriber.id
, subscriber.id_type
, subscriber.id_pipe
, subscriber.id_client
, subscriber.parcel
, subscriber.id_district
, subscriber.id_pressurezone
, subscriber.id_printmap
, subscriber._printmaps
, subscriber._districts
, subscriber.geometry
, subscriber_type.name AS _type
, district.name AS _district
, (
     (
           (district.subscriber_prefix)::text || &apos;-&apos;::text
     ) || 
     (subscriber.id_client)::text
) AS id_client_full
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode 
FROM (
     (
           (distribution.subscriber 
              JOIN distribution.subscriber_type 
                ON (
                       (subscriber.id_type = subscriber_type.id)
                 )
           )
   LEFT JOIN distribution.district 
          ON (
                 (subscriber.id_district = district.id)
           )
     )
LEFT JOIN distribution.pressurezone 
    ON (
           (subscriber.id_pressurezone = pressurezone.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.valve"
               xreflabel="distribution.valve">
        <title id="distribution.table.valve-title">
         Table:
         
         <structname>valve</structname>
        </title>
 

        <para>
          Table for valve.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>valve</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.valve-type"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.valve-function"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_maintenance</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pipe</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pipe"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>diameter_nominal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>closed</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.node"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.district"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="distribution.table.pressurezone"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry_schematic</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on valve</title>

          <varlistentry>
            <term>valve_year_check</term>
            <listitem><para>CHECK (((year &gt; 1800) AND (year &lt; 2100)))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on valve</title>

          <varlistentry>
            <term>fki_valve_id_district</term>
            <listitem><para>id_district</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_valve_id_function</term>
            <listitem><para>id_function</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_valve_id_node</term>
            <listitem><para>id_node</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_valve_id_pipe</term>
            <listitem><para>id_pipe</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_valve_id_pressurezone</term>
            <listitem><para>id_pressurezone</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_valve_id_type</term>
            <listitem><para>id_type</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>valve_geoidx</term>
            <listitem><para>geometry</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>valve_geoidx_sch</term>
            <listitem><para>geometry_schematic</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="distribution.table.valve-function"
               xreflabel="distribution.valve_function">
        <title id="distribution.table.valve-function-title">
         Table:
         
         <structname>valve_function</structname>
        </title>
 

        <para>
          Types of valve
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>valve_function</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>function</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>shortname</structfield></term>
              <listitem><para>
                <type>character varying(5)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing valve via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.valve"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.table.valve-maintenance"
               xreflabel="distribution.valve_maintenance">
        <title id="distribution.table.valve-maintenance-title">
         Table:
         
         <structname>valve_maintenance</structname>
        </title>
 

        <para>
          valve_maintenance table.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>valve_maintenance</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(35)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>comment</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on valve_maintenance</title>

          <varlistentry>
            <term>valve_maintenance_priority_check</term>
            <listitem><para>CHECK (((priority &gt; 0) AND (priority &lt; 4)))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="distribution.view.valve-schema"
               xreflabel="distribution.valve_schema">
        <title id="distribution.view.valve-schema-title">
         View:
         
         <structname>valve_schema</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>valve_schema</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pipe</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_maintenance</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>diameter_nominal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function_shortname</structfield></term>
              <listitem><para>
                <type>character varying(5)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_label</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_altitude_dtm</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view valve_schema</title>
         <programlisting>
SELECT valve.id
, valve.sige
, valve.id_type
, valve.id_function
, valve.id_pipe
, valve.id_maintenance
, valve.diameter_nominal
, valve.year
, valve.closed
, valve.altitude_real
, valve.remarks
, valve.schema_force_view
, valve.id_node
, valve.id_district
, valve.id_pressurezone
, valve._districts
, valve._printmaps
, valve.geometry_schematic AS geometry
, valve_function.function AS _function
, valve_function.shortname AS _function_shortname
, valve_type.type AS _type
, CASE WHEN 
(valve_function.shortname IS NULL) THEN 
(
     (valve.sige)::character varying
)::text ELSE 
(
     (valve_function.shortname)::text || 
     (
           (valve.sige)::character varying
     )::text
) END AS _label
, node.altitude_dtm AS _altitude_dtm
, district.name AS _district
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode 
FROM (
     (
           (
                 (
                       (distribution.valve 
                          JOIN distribution.valve_type 
                            ON (
                                   (valve.id_function = valve_type.id)
                             )
                       )
                    JOIN distribution.valve_function 
                      ON (
                             (valve.id_function = valve_function.id)
                       )
                 )
         LEFT JOIN distribution.node 
                ON (
                       (valve.id_node = node.id)
                 )
           )
   LEFT JOIN distribution.district 
          ON (
                 (valve.id_district = district.id)
           )
     )
LEFT JOIN distribution.pressurezone 
    ON (
           (valve.id_pressurezone = pressurezone.id)
     )
)
WHERE (
     (valve.schema_force_view IS TRUE)
    OR (
           (valve.schema_force_view IS NULL)
         AND (valve_function.schema_view IS TRUE)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.valve-type"
               xreflabel="distribution.valve_type">
        <title id="distribution.table.valve-type-title">
         Table:
         
         <structname>valve_type</structname>
        </title>
 

        <para>
          Types of valve
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>valve_type</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing valve via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="distribution.table.valve"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="distribution.view.valve-view"
               xreflabel="distribution.valve_view">
        <title id="distribution.view.valve-view-title">
         View:
         
         <structname>valve_view</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>valve_view</structname>
            </title>


            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sige</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_type</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_function</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_maintenance</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pipe</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>diameter_nominal</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>year</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>closed</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>altitude_real</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>remarks</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_force_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_node</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_district</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_pressurezone</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id_printmap</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_printmaps</structfield></term>
              <listitem><para>
                <type>character varying(100)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_districts</structfield></term>
              <listitem><para>
                <type>character varying(255)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geometry</structfield></term>
              <listitem><para>
                <type>geometry(Point,21781)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_function_shortname</structfield></term>
              <listitem><para>
                <type>character varying(5)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_type</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_label</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_schema_view</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_altitude_dtm</structfield></term>
              <listitem><para>
                <type>numeric(10,3)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_district</structfield></term>
              <listitem><para>
                <type>character varying(40)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_shortname</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_consummerzone</structfield></term>
              <listitem><para>
                <type>character varying(30)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_pressurezone_colorcode</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view valve_view</title>
         <programlisting>
SELECT valve.id
, valve.sige
, valve.id_type
, valve.id_function
, valve.id_maintenance
, valve.id_pipe
, valve.diameter_nominal
, valve.year
, valve.closed
, valve.altitude_real
, valve.remarks
, valve.schema_force_view
, valve.id_node
, valve.id_district
, valve.id_pressurezone
, valve.id_printmap
, valve._printmaps
, valve._districts
, valve.geometry
, valve_function.function AS _function
, valve_function.shortname AS _function_shortname
, valve_type.type AS _type
, CASE WHEN 
(valve_function.shortname IS NULL) THEN 
(
     (valve.sige)::character varying
)::text ELSE 
(
     (valve_function.shortname)::text || 
     (
           (valve.sige)::character varying
     )::text
) END AS _label
, CASE WHEN 
(valve.schema_force_view IS NULL) THEN valve_function.schema_view ELSE valve.schema_force_view END AS _schema_view
, node.altitude_dtm AS _altitude_dtm
, district.name AS _district
, pressurezone.name AS _pressurezone
, pressurezone.shortname AS _pressurezone_shortname
, pressurezone.consummerzone AS _consummerzone
, pressurezone.colorcode AS _pressurezone_colorcode 
FROM (
     (
           (
                 (
                       (distribution.valve 
                          JOIN distribution.valve_type 
                            ON (
                                   (valve.id_type = valve_type.id)
                             )
                       )
                    JOIN distribution.valve_function 
                      ON (
                             (valve.id_function = valve_function.id)
                       )
                 )
         LEFT JOIN distribution.node 
                ON (
                       (valve.id_node = node.id)
                 )
           )
   LEFT JOIN distribution.district 
          ON (
                 (valve.id_district = district.id)
           )
     )
LEFT JOIN distribution.pressurezone 
    ON (
           (valve.id_pressurezone = pressurezone.id)
     )
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="distribution.table.visible"
               xreflabel="distribution.visible">
        <title id="distribution.table.visible-title">
         Table:
         
         <structname>visible</structname>
        </title>
 

        <para>
          Table for editing in qgis tri state boolean (NULL/True/False) by using value relation.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>visible</structname>
            </title>


            <varlistentry>
              <term><structfield>x</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>boolean</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>character varying(50)</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



<!-- Function dimension_geom() -->
    <section id="distribution.function.dimension-geom"
             xreflabel="distributiondimension_geom()">
      <title id="distribution.function.dimension-geom-title">
       dimension_geom()
      </title>
      <titleabbrev id="distribution.function.dimension-geom-titleabbrev">
       dimension_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Fcn/Trigger: updates the map distance between the two extremities of the arc.
        <programlisting> 
	BEGIN
		UPDATE distribution.dimension SET 
			_distance_terrain = ST_Distance( ST_GeometryN(NEW.geometry,1) , ST_GeometryN(NEW.geometry,ST_NumGeometries(NEW.geometry)) )
		WHERE id = NEW.id ;
		RETURN NEW;
	END;
</programlisting>
      </para>
    </section>

<!-- Function geom_tool_line(character varying) -->
    <section id="distribution.function.geom-tool-line-character-varying"
             xreflabel="distributiongeom_tool_line(character varying)">
      <title id="distribution.function.geom-tool-line-character-varying-title">
       geom_tool_line(character varying)
      </title>
      <titleabbrev id="distribution.function.geom-tool-line-character-varying-titleabbrev">
       geom_tool_line(character varying)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       Create geometric columns, constraint and triggers for tables with line items.
        <programlisting>
	DECLARE
		table_name ALIAS for $1;
	BEGIN
		/* Creates columns */
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_node_a       integer   ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_node_b       integer   ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_district     integer   ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_pressurezone integer   ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_printmap     integer[] ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN _length2d       decimal(8,2) ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN _length3d       decimal(8,2) ;&#39;;	
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN _printmaps      varchar(100) ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN _districts      varchar(255) ;&#39;;
			
		/* Enables geometry */
		PERFORM addGeometryColumn(&#39;distribution&#39;, table_name, &#39;geometry&#39;, 21781, &#39;LINESTRING&#39;, 2);
		PERFORM addGeometryColumn(&#39;distribution&#39;, table_name, &#39;geometry_schematic&#39;, 21781, &#39;LINESTRING&#39;, 2);
		EXECUTE &#39;CREATE INDEX &#39;||table_name||&#39;_geoidx     ON distribution.&#39;||table_name||&#39; USING GIST ( geometry );&#39;;
		EXECUTE &#39;CREATE INDEX &#39;||table_name||&#39;_geoidx_sch ON distribution.&#39;||table_name||&#39; USING GIST ( geometry_schematic );&#39;;		

		/* Add constraints and indexes */
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_node_a       FOREIGN KEY (id_node_a)       REFERENCES distribution.node(id)         MATCH SIMPLE;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_node_b       FOREIGN KEY (id_node_b)       REFERENCES distribution.node(id)         MATCH SIMPLE;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_district     FOREIGN KEY (id_district)     REFERENCES distribution.district(id)     MATCH SIMPLE;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_pressurezone FOREIGN KEY (id_pressurezone) REFERENCES distribution.pressurezone(id) MATCH SIMPLE;&#39;;
		EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_node_a       ON distribution.&#39;||table_name||&#39;(id_node_a);&#39;;
		EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_node_b       ON distribution.&#39;||table_name||&#39;(id_node_b);&#39;;
		EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_district     ON distribution.&#39;||table_name||&#39;(id_district);&#39;;
		EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_pressurezone ON distribution.&#39;||table_name||&#39;(id_pressurezone);&#39;;
		
		/* Geometric triggers */
		EXECUTE &#39;
			CREATE OR REPLACE FUNCTION distribution.&#39;||table_name||&#39;_geom() RETURNS TRIGGER AS
				&#39;&#39;
				BEGIN
					UPDATE distribution.&#39;||table_name||&#39; SET
						id_node_a          = distribution.node_get_id(ST_StartPoint(NEW.geometry),true),
						id_node_b          = distribution.node_get_id(ST_EndPoint(  NEW.geometry),true),
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						geometry_schematic = NEW.geometry,
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry),
						_length2d          = ST_Length(NEW.geometry),
						_length3d          = NULL
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				&#39;&#39;
				LANGUAGE &#39;&#39;plpgsql&#39;&#39;;		
		&#39;;
		
		EXECUTE &#39;CREATE TRIGGER &#39;||table_name||&#39;_geom_trigger_insert
			AFTER INSERT ON distribution.&#39;||table_name||&#39;
			FOR EACH ROW
			EXECUTE PROCEDURE distribution.&#39;||table_name||&#39;_geom();&#39;;
		EXECUTE &#39;COMMENT ON TRIGGER &#39;||table_name||&#39;_geom_trigger_insert ON distribution.&#39;||table_name||&#39; IS &#39;&#39;Trigger: updates auto fields of the &#39;||table_name||&#39; after insert.&#39;&#39;;&#39;;

		EXECUTE &#39;CREATE TRIGGER &#39;||table_name||&#39;_geom_trigger_update
			AFTER UPDATE OF geometry ON distribution.&#39;||table_name||&#39; 
			FOR EACH ROW
			WHEN (ST_AsBinary(NEW.geometry) &lt;&gt; ST_AsBinary(OLD.geometry))
			EXECUTE PROCEDURE distribution.&#39;||table_name||&#39;_geom();&#39;;
		EXECUTE &#39;COMMENT ON TRIGGER &#39;||table_name||&#39;_geom_trigger_update ON distribution.&#39;||table_name||&#39; IS &#39;&#39;Trigger: updates auto fields of the &#39;||table_name||&#39; after geom update.&#39;&#39;;&#39;;
	END;
</programlisting>
      </para>
    </section>

<!-- Function geom_tool_point(create_schematic character varying, create_node boolean, is_node boolean, table_name boolean) -->
    <section id="distribution.function.geom-tool-point-create-schematic-character-varying-create-node-boolean-is-node-boolean-table-name-boolean"
             xreflabel="distributiongeom_tool_point(create_schematic character varying, create_node boolean, is_node boolean, table_name boolean)">
      <title id="distribution.function.geom-tool-point-create-schematic-character-varying-create-node-boolean-is-node-boolean-table-name-boolean-title">
       geom_tool_point(create_schematic character varying, create_node boolean, is_node boolean, table_name boolean)
      </title>
      <titleabbrev id="distribution.function.geom-tool-point-create-schematic-character-varying-create-node-boolean-is-node-boolean-table-name-boolean-titleabbrev">
       geom_tool_point(create_schematic character varying, create_node boolean, is_node boolean, table_name boolean)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       Create geometric columns, constraint and triggers for tables with point on node items. Second argument determines if node has to be created or not of not found.
        <programlisting>
	DECLARE
		sql_trigger varchar;
	BEGIN
		/* Creates columns */
		IF is_node IS TRUE THEN
			EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_node         integer   ;&#39;;
		END IF;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_district     integer   ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_pressurezone integer   ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN id_printmap     integer[] ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN _printmaps      varchar(100) ;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD COLUMN _districts      varchar(255) ;&#39;;
		
		/* Enables geometry */
		PERFORM addGeometryColumn(&#39;distribution&#39;, table_name, &#39;geometry&#39;, 21781, &#39;POINT&#39;, 2);
		EXECUTE &#39;CREATE INDEX &#39;||table_name||&#39;_geoidx     ON distribution.&#39;||table_name||&#39; USING GIST ( geometry );&#39;;
		IF create_schematic IS TRUE THEN
			PERFORM addGeometryColumn(&#39;distribution&#39;, table_name, &#39;geometry_schematic&#39;, 21781, &#39;POINT&#39;, 2);
			EXECUTE &#39;CREATE INDEX &#39;||table_name||&#39;_geoidx_sch ON distribution.&#39;||table_name||&#39; USING GIST ( geometry_schematic );&#39;;		
		END IF;
				
		/* Add constraints and indexes */
		IF is_node IS TRUE THEN
			EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_node         FOREIGN KEY (id_node)         REFERENCES distribution.node(id)         MATCH SIMPLE;&#39;;
		END IF;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_district     FOREIGN KEY (id_district)     REFERENCES distribution.district(id)     MATCH SIMPLE;&#39;;
		EXECUTE &#39;ALTER TABLE distribution.&#39;||table_name||&#39; ADD CONSTRAINT &#39;||table_name||&#39;_id_pressurezone FOREIGN KEY (id_pressurezone) REFERENCES distribution.pressurezone(id) MATCH SIMPLE;&#39;;
		IF is_node IS TRUE THEN
			EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_node     ON distribution.&#39;||table_name||&#39;(id_node);&#39;;
		END IF;
		EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_district     ON distribution.&#39;||table_name||&#39;(id_district);&#39;;
		EXECUTE &#39;CREATE INDEX fki_&#39;||table_name||&#39;_id_pressurezone ON distribution.&#39;||table_name||&#39;(id_pressurezone);&#39;;
		
		/* Geometric triggers */
		sql_trigger := &#39;CREATE OR REPLACE FUNCTION distribution.&#39;||table_name||&#39;_geom() RETURNS TRIGGER AS
				&#39;&#39;
				BEGIN
					UPDATE distribution.&#39;||table_name||&#39; SET&#39;;
		IF is_node IS TRUE AND create_node IS TRUE THEN
			sql_trigger := sql_trigger || &#39;
						id_node            = distribution.node_get_id(NEW.geometry,&#39;||create_node||&#39;),
			&#39;;
		END IF;
		sql_trigger := sql_trigger || &#39;
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),&#39;;
		IF create_schematic IS TRUE THEN
			sql_trigger := sql_trigger || &#39;
						geometry_schematic = NEW.geometry,
			&#39;;
		END IF;
		sql_trigger := sql_trigger || &#39;
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry)
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				&#39;&#39;
				LANGUAGE &#39;&#39;plpgsql&#39;&#39;;		
		&#39;;
		EXECUTE sql_trigger;
		
		EXECUTE &#39;CREATE TRIGGER &#39;||table_name||&#39;_geom_trigger_insert
			AFTER INSERT ON distribution.&#39;||table_name||&#39;
			FOR EACH ROW
			EXECUTE PROCEDURE distribution.&#39;||table_name||&#39;_geom();&#39;;
		EXECUTE &#39;COMMENT ON TRIGGER &#39;||table_name||&#39;_geom_trigger_insert ON distribution.&#39;||table_name||&#39; IS &#39;&#39;Trigger: updates auto fields of the &#39;||table_name||&#39; after insert.&#39;&#39;;&#39;;

		EXECUTE &#39;CREATE TRIGGER &#39;||table_name||&#39;_geom_trigger_update
			AFTER UPDATE OF geometry ON distribution.&#39;||table_name||&#39; 
			FOR EACH ROW
			WHEN (ST_AsBinary(NEW.geometry) &lt;&gt; ST_AsBinary(OLD.geometry))
			EXECUTE PROCEDURE distribution.&#39;||table_name||&#39;_geom();&#39;;
		EXECUTE &#39;COMMENT ON TRIGGER &#39;||table_name||&#39;_geom_trigger_update ON distribution.&#39;||table_name||&#39; IS &#39;&#39;Trigger: updates auto fields of the &#39;||table_name||&#39; after geom update.&#39;&#39;;&#39;;
	END;
</programlisting>
      </para>
    </section>

<!-- Function get_district_id(public.geometry) -->
    <section id="distribution.function.get-district-id-public.geometry"
             xreflabel="distributionget_district_id(public.geometry)">
      <title id="distribution.function.get-district-id-public.geometry-title">
       get_district_id(public.geometry)
      </title>
      <titleabbrev id="distribution.function.get-district-id-public.geometry-titleabbrev">
       get_district_id(public.geometry)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns the id of the first overlapping district.
        <programlisting>
	DECLARE
		geom ALIAS FOR $1;
		id_district integer;
	BEGIN
		SELECT district.id INTO id_district
			FROM  distribution.district
			WHERE ST_Intersects(geom,district.geometry) IS TRUE
			LIMIT 1;
		RETURN id_district;
	END;
</programlisting>
      </para>
    </section>

<!-- Function get_districts(public.geometry) -->
    <section id="distribution.function.get-districts-public.geometry"
             xreflabel="distributionget_districts(public.geometry)">
      <title id="distribution.function.get-districts-public.geometry-title">
       get_districts(public.geometry)
      </title>
      <titleabbrev id="distribution.function.get-districts-public.geometry-titleabbrev">
       get_districts(public.geometry)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns a coma separeted list of the districts overlapping the given geometry.
        <programlisting>
	DECLARE
		geom ALIAS FOR $1;
		result text;
	BEGIN
		SELECT string_agg(district.name , &#39;, &#39;) INTO result
			FROM  distribution.district
			WHERE ST_Intersects(geom,district.geometry) IS TRUE;
		RETURN result;
	END;
</programlisting>
      </para>
    </section>

<!-- Function get_parent(integer, integer) -->
    <section id="distribution.function.get-parent-integer-integer"
             xreflabel="distributionget_parent(integer, integer)">
      <title id="distribution.function.get-parent-integer-integer-title">
       get_parent(integer, integer)
      </title>
      <titleabbrev id="distribution.function.get-parent-integer-integer-titleabbrev">
       get_parent(integer, integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       Function to get a group ID (parent/children). Also works in case of sub-parent
        <programlisting>
	DECLARE
		childid ALIAS FOR $1;
		parentid ALIAS FOR $2;
	BEGIN
		IF parentid IS NULL THEN
			RETURN childid;
		END IF;
		LOOP
			SELECT id_parent INTO childid 
			FROM distribution.pipe_schema_viewableitems
			WHERE id = parentid;

			IF childid IS NOT NULL THEN
				parentid := childid;
			ELSE
				RETURN parentid;
			END IF;
		END LOOP;
	END
</programlisting>
      </para>
    </section>

<!-- Function get_pressurezone_id(public.geometry) -->
    <section id="distribution.function.get-pressurezone-id-public.geometry"
             xreflabel="distributionget_pressurezone_id(public.geometry)">
      <title id="distribution.function.get-pressurezone-id-public.geometry-title">
       get_pressurezone_id(public.geometry)
      </title>
      <titleabbrev id="distribution.function.get-pressurezone-id-public.geometry-titleabbrev">
       get_pressurezone_id(public.geometry)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns the id of the first overlapping pressurezone.
        <programlisting> 
	DECLARE
		geom ALIAS FOR $1;
		id_pressurezone integer;
	BEGIN
		SELECT pressurezone.id INTO id_pressurezone
			FROM  distribution.pressurezone
			WHERE ST_Intersects(geom,pressurezone.geometry) IS TRUE
			ORDER BY ST_Length(ST_Intersection(geom,pressurezone.geometry)) DESC
			LIMIT 1;
		RETURN id_pressurezone;
	END
</programlisting>
      </para>
    </section>

<!-- Function get_printmap_id(public.geometry) -->
    <section id="distribution.function.get-printmap-id-public.geometry"
             xreflabel="distributionget_printmap_id(public.geometry)">
      <title id="distribution.function.get-printmap-id-public.geometry-title">
       get_printmap_id(public.geometry)
      </title>
      <titleabbrev id="distribution.function.get-printmap-id-public.geometry-titleabbrev">
       get_printmap_id(public.geometry)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer[]</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns the id of the first overlapping printmap.
        <programlisting>
	DECLARE
		geom ALIAS FOR $1;
	BEGIN
		RETURN ARRAY( SELECT printmap.id FROM  distribution.printmap WHERE ST_Intersects(geom,printmap.geometry) IS TRUE);
	END;
</programlisting>
      </para>
    </section>

<!-- Function get_printmaps(public.geometry) -->
    <section id="distribution.function.get-printmaps-public.geometry"
             xreflabel="distributionget_printmaps(public.geometry)">
      <title id="distribution.function.get-printmaps-public.geometry-title">
       get_printmaps(public.geometry)
      </title>
      <titleabbrev id="distribution.function.get-printmaps-public.geometry-titleabbrev">
       get_printmaps(public.geometry)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns a string contaning all the short names of the polygons in table printmap which overlap the given geometry.
        <programlisting>
	DECLARE
		geom ALIAS FOR $1;
		result text;
	BEGIN
		SELECT string_agg(printmap.short_name , &#39;, &#39;) INTO result
			FROM  distribution.printmap
			WHERE ST_Intersects(geom,printmap.geometry) IS TRUE;
		RETURN result;
	END;
</programlisting>
      </para>
    </section>

<!-- Function hydrant_geom() -->
    <section id="distribution.function.hydrant-geom"
             xreflabel="distributionhydrant_geom()">
      <title id="distribution.function.hydrant-geom-title">
       hydrant_geom()
      </title>
      <titleabbrev id="distribution.function.hydrant-geom-titleabbrev">
       hydrant_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
				BEGIN
					UPDATE distribution.hydrant SET
						id_node            = distribution.node_get_id(NEW.geometry,true),
			
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						geometry_schematic = NEW.geometry,
			
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry)
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				</programlisting>
      </para>
    </section>

<!-- Function installation_geom() -->
    <section id="distribution.function.installation-geom"
             xreflabel="distributioninstallation_geom()">
      <title id="distribution.function.installation-geom-title">
       installation_geom()
      </title>
      <titleabbrev id="distribution.function.installation-geom-titleabbrev">
       installation_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
				BEGIN
					UPDATE distribution.installation SET
						id_node            = distribution.node_get_id(NEW.geometry,true),
			
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						geometry_schematic = NEW.geometry,
			
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry)
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				</programlisting>
      </para>
    </section>

<!-- Function node_altitude() -->
    <section id="distribution.function.node-altitude"
             xreflabel="distributionnode_altitude()">
      <title id="distribution.function.node-altitude-title">
       node_altitude()
      </title>
      <titleabbrev id="distribution.function.node-altitude-titleabbrev">
       node_altitude()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       Fill the altitude of the node.
        <programlisting>
	BEGIN
		UPDATE distribution.node SET altitude_dtm = altitude.altitude(geometry) WHERE altitude_dtm IS NULL ;
	END;
</programlisting>
      </para>
    </section>

<!-- Function node_geom() -->
    <section id="distribution.function.node-geom"
             xreflabel="distributionnode_geom()">
      <title id="distribution.function.node-geom-title">
       node_geom()
      </title>
      <titleabbrev id="distribution.function.node-geom-titleabbrev">
       node_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Fcn/Trigger: set uptodate to false for altitude when geometry changes.
        <programlisting> 
	BEGIN
		UPDATE distribution.node SET
			altitude_dtm = NULL
		WHERE id = NEW.id ;
		RETURN NEW;
	END;
</programlisting>
      </para>
    </section>

<!-- Function node_get_id(public.geometry, boolean) -->
    <section id="distribution.function.node-get-id-public.geometry-boolean"
             xreflabel="distributionnode_get_id(public.geometry, boolean)">
      <title id="distribution.function.node-get-id-public.geometry-boolean-title">
       node_get_id(public.geometry, boolean)
      </title>
      <titleabbrev id="distribution.function.node-get-id-public.geometry-boolean-titleabbrev">
       node_get_id(public.geometry, boolean)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns the node for a given geometry (point). If node does not exist and if specified in argument, it is created.
        <programlisting>
	DECLARE
		point ALIAS for $1;
		place_node ALIAS for $2;
		node_id integer;
	BEGIN
		SELECT id FROM distribution.node WHERE ST_DWithin(point,geometry,0) IS TRUE LIMIT 1 INTO node_id;
		IF node_id IS NULL AND place_node IS TRUE THEN
			INSERT INTO distribution.node (geometry) VALUES (point);
			SELECT id FROM distribution.node WHERE ST_DWithin(point,geometry,0) IS TRUE LIMIT 1 INTO node_id;
		END IF;
		RETURN node_id;	
	END;
</programlisting>
      </para>
    </section>

<!-- Function node_set_type() -->
    <section id="distribution.function.node-set-type"
             xreflabel="distributionnode_set_type()">
      <title id="distribution.function.node-set-type-title">
       node_set_type()
      </title>
      <titleabbrev id="distribution.function.node-set-type-titleabbrev">
       node_set_type()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       Set the type and orientation for node. If three pipe arrives at the node: intersection. If one pipe: end. If two: depends on characteristics of pipe: year (is different), material (and year), diameter(and material/year)
        <programlisting>
	DECLARE
		node record;
	BEGIN
		FOR node IN SELECT id FROM distribution.node ORDER BY id LOOP
			PERFORM distribution.node_type(node.id);
		END LOOP;
	END;
</programlisting>
      </para>
    </section>

<!-- Function node_type(integer) -->
    <section id="distribution.function.node-type-integer"
             xreflabel="distributionnode_type(integer)">
      <title id="distribution.function.node-type-integer-title">
       node_type(integer)
      </title>
      <titleabbrev id="distribution.function.node-type-integer-titleabbrev">
       node_type(integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       Set the orientation and type for a node. If three pipe arrives at the node: intersection. If one pipe: end. If two: depends on characteristics of pipe: year (is different), material (and year), diameter(and material/year)
        <programlisting>
	DECLARE
		node_id     ALIAS FOR $1         ;
		pipeitem    RECORD               ;
		grouped     RECORD               ;
		Tyear       INTEGER              ;
		Tmaterial   VARCHAR(30)          ;
		Tdiameter   VARCHAR(10)          ;
		i           INTEGER          := 0;
		type        VARCHAR(20)          ;
		ori1        DOUBLE PRECISION := 0;
		ori2        DOUBLE PRECISION := 0;
		orientation FLOAT            := 0;
	BEGIN
		SELECT 
			COUNT(pipe_view.id)               AS count         ,
			bool_or(pipe_view._schema_view)   AS schema_view   ,
			bool_or(pipe_view._status_active) AS status_active
			INTO grouped 
			FROM distribution.pipe_view 
			WHERE (id_node_a = node_id OR id_node_b = node_id);
		IF grouped.count = 0 THEN
			IF node_id IN (SELECT id_node FROM distribution.valve) THEN
				type := &#39;valve&#39;;
			ELSEIF node_id IN (SELECT id_node FROM distribution.installation) THEN
				type := &#39;installation&#39;;
			ELSEIF node_id IN (SELECT id_node FROM distribution.hydrant) THEN
				type := &#39;hydrant&#39;;
			ELSE
				RAISE NOTICE &#39;Delete node %&#39; , node_id ;
				DELETE FROM distribution.node WHERE id = node_id ;
			END IF;
		ELSEIF grouped.count = 1 THEN
			type := &#39;one&#39;;
		ELSEIF grouped.count = 2 THEN
			FOR pipeitem IN (
				SELECT year,_material_longname,_material_diameter,ST_PointN(geometry,2)                      AS point_1 , ST_StartPoint(geometry) AS point_2 FROM distribution.pipe_view WHERE id_node_a = node_id
				UNION ALL
				SELECT year,_material_longname,_material_diameter,ST_PointN(geometry,ST_NPoints(geometry)-1) AS point_1 , ST_EndPoint(  geometry) AS point_2 FROM distribution.pipe_view WHERE id_node_b = node_id
			) LOOP
				IF i=0 THEN
					Tyear     := pipeitem.year;
					Tmaterial := pipeitem._material_longname;
					Tdiameter := pipeitem._material_diameter;
					i := 1;
					SELECT  ST_Azimuth(pipeitem.point_1,pipeitem.point_2) INTO ori1 ;
				ELSE
					type := &#39;two_same&#39;;
					IF Tyear     != pipeitem.year               THEN type := &#39;two_year&#39;    ; END IF;
					IF Tmaterial != pipeitem._material_longname THEN type := &#39;two_material&#39;; END IF;
					IF Tdiameter != pipeitem._material_diameter THEN type := &#39;two_diameter&#39;; END IF;
					SELECT ST_Azimuth(pipeitem.point_1,pipeitem.point_2) INTO ori2 ;
					SELECT degrees( ATAN2( (SIN(ori1)+SIN(ori2))/2 , (COS(ori1)+COS(ori2))/2 ) ) INTO orientation;
				END IF;
			END LOOP;
		ELSEIF grouped.count &gt; 2 THEN
			type := &#39;three&#39;;
		END IF;
		UPDATE distribution.node SET 
			_type          = type,
			_orientation   = orientation,
			_schema_view   = grouped.schema_view,
			_status_active = grouped.status_active
			WHERE id = node_id;
		/*RAISE NOTICE &#39;% %&#39; , node_id , orientation;*/
	END;
</programlisting>
      </para>
    </section>

<!-- Function pipe_count_valve(integer) -->
    <section id="distribution.function.pipe-count-valve-integer"
             xreflabel="distributionpipe_count_valve(integer)">
      <title id="distribution.function.pipe-count-valve-integer-title">
       pipe_count_valve(integer)
      </title>
      <titleabbrev id="distribution.function.pipe-count-valve-integer-titleabbrev">
       pipe_count_valve(integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       Determine if a pipe is closed by a valve or not.
        <programlisting>
	DECLARE
		pipe_id ALIAS for $1;
		valve_count integer;
	BEGIN
		SELECT COUNT(id) FROM distribution.valve WHERE id_pipe = pipe_id INTO valve_count;
		RETURN valve_count ;
	END
</programlisting>
      </para>
    </section>

<!-- Function pipe_geom() -->
    <section id="distribution.function.pipe-geom"
             xreflabel="distributionpipe_geom()">
      <title id="distribution.function.pipe-geom-title">
       pipe_geom()
      </title>
      <titleabbrev id="distribution.function.pipe-geom-titleabbrev">
       pipe_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
				BEGIN
					UPDATE distribution.pipe SET
						id_node_a          = distribution.node_get_id(ST_StartPoint(NEW.geometry),true),
						id_node_b          = distribution.node_get_id(ST_EndPoint(  NEW.geometry),true),
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						geometry_schematic = NEW.geometry,
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry),
						_length2d          = ST_Length(NEW.geometry),
						_length3d          = NULL
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				</programlisting>
      </para>
    </section>

<!-- Function pipe_get_id(public.geometry) -->
    <section id="distribution.function.pipe-get-id-public.geometry"
             xreflabel="distributionpipe_get_id(public.geometry)">
      <title id="distribution.function.pipe-get-id-public.geometry-title">
       pipe_get_id(public.geometry)
      </title>
      <titleabbrev id="distribution.function.pipe-get-id-public.geometry-titleabbrev">
       pipe_get_id(public.geometry)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns the pipe at a given position. If several pipe, return NULL.
        <programlisting>
	DECLARE
		point ALIAS for $1;
		pipe_id integer;
		distance_threshold double precision := 0.000001;
		number_of_pipe integer;
	BEGIN
		SELECT COUNT(id) FROM distribution.pipe WHERE ST_DWithin(point,geometry,distance_threshold) INTO number_of_pipe;
		IF number_of_pipe != 1 THEN
			RETURN NULL ;
		ELSE 
			SELECT id FROM distribution.pipe WHERE ST_DWithin(point,geometry,distance_threshold) INTO pipe_id ;
			RETURN pipe_id;	
		END IF;
	END;
</programlisting>
      </para>
    </section>

<!-- Function pipe_isclosed(integer) -->
    <section id="distribution.function.pipe-isclosed-integer"
             xreflabel="distributionpipe_isclosed(integer)">
      <title id="distribution.function.pipe-isclosed-integer-title">
       pipe_isclosed(integer)
      </title>
      <titleabbrev id="distribution.function.pipe-isclosed-integer-titleabbrev">
       pipe_isclosed(integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
	DECLARE
		pipe_id ALIAS for $1;
		isClosed boolean;
	BEGIN
		SELECT bool_or(closed) FROM distribution.valve WHERE id_pipe = pipe_id INTO isClosed;
		RETURN isClosed ;
	END
</programlisting>
      </para>
    </section>

<!-- Function pipe_length3d() -->
    <section id="distribution.function.pipe-length3d"
             xreflabel="distributionpipe_length3d()">
      <title id="distribution.function.pipe-length3d-title">
       pipe_length3d()
      </title>
      <titleabbrev id="distribution.function.pipe-length3d-titleabbrev">
       pipe_length3d()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       Fill the 3d length of the pipe.
        <programlisting>
	DECLARE
		length double precision;
		pipeitem RECORD;
	BEGIN
		FOR pipeitem IN SELECT id,geometry,tunnel_or_bridge FROM distribution.pipe WHERE _length3d IS NULL ORDER BY id LOOP
			IF pipeitem.tunnel_or_bridge IS TRUE THEN
				length := pipeitem._length2d;
			ELSE
				RAISE NOTICE &#39;%&#39;, pipeitem.id;
				SELECT altitude.length3d(pipeitem.geometry) INTO length;
			END IF;
			UPDATE distribution.pipe SET _length3d = length WHERE id = pipeitem.id;
		END LOOP;
	END
</programlisting>
      </para>
    </section>

<!-- Function pipe_material_fancy_name() -->
    <section id="distribution.function.pipe-material-fancy-name"
             xreflabel="distributionpipe_material_fancy_name()">
      <title id="distribution.function.pipe-material-fancy-name-title">
       pipe_material_fancy_name()
      </title>
      <titleabbrev id="distribution.function.pipe-material-fancy-name-titleabbrev">
       pipe_material_fancy_name()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Fcn/Trigger: updates the fancy name in the material table.
        <programlisting> 
	BEGIN
		 UPDATE distribution.pipe_material SET _fancy_name = NEW.short_name||&#39; &#39;||NEW.diameter WHERE id = NEW.id ;
		 RETURN NEW;
	END;
</programlisting>
      </para>
    </section>

<!-- Function pipe_tunnelbridge() -->
    <section id="distribution.function.pipe-tunnelbridge"
             xreflabel="distributionpipe_tunnelbridge()">
      <title id="distribution.function.pipe-tunnelbridge-title">
       pipe_tunnelbridge()
      </title>
      <titleabbrev id="distribution.function.pipe-tunnelbridge-titleabbrev">
       pipe_tunnelbridge()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting> 
	BEGIN
		UPDATE distribution.pipe SET _length3d = _length2d WHERE id = NEW.id AND NEW.tunnel_or_bridge IS TRUE;
		UPDATE distribution.pipe SET _length3d = NULL      WHERE id = NEW.id AND NEW.tunnel_or_bridge IS FALSE;
		RETURN NEW;
	END;
</programlisting>
      </para>
    </section>

<!-- Function printmap_geom() -->
    <section id="distribution.function.printmap-geom"
             xreflabel="distributionprintmap_geom()">
      <title id="distribution.function.printmap-geom-title">
       printmap_geom()
      </title>
      <titleabbrev id="distribution.function.printmap-geom-titleabbrev">
       printmap_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Fcn/Trigger: updates the size of the bounding box into width/length fields.
        <programlisting> 
	BEGIN
		UPDATE distribution.printmap SET 
			_east   = ST_XMax(BOX2D(NEW.geometry))-ST_XMin(BOX2D(NEW.geometry)),
			_north  = ST_YMax(BOX2D(NEW.geometry))-ST_YMin(BOX2D(NEW.geometry))
		WHERE id = NEW.id ;
		RETURN NEW;
	END;
</programlisting>
      </para>
    </section>

<!-- Function samplingpoint_geom() -->
    <section id="distribution.function.samplingpoint-geom"
             xreflabel="distributionsamplingpoint_geom()">
      <title id="distribution.function.samplingpoint-geom-title">
       samplingpoint_geom()
      </title>
      <titleabbrev id="distribution.function.samplingpoint-geom-titleabbrev">
       samplingpoint_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
				BEGIN
					UPDATE distribution.samplingpoint SET
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry)
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				</programlisting>
      </para>
    </section>

<!-- Function subscriber_geom() -->
    <section id="distribution.function.subscriber-geom"
             xreflabel="distributionsubscriber_geom()">
      <title id="distribution.function.subscriber-geom-title">
       subscriber_geom()
      </title>
      <titleabbrev id="distribution.function.subscriber-geom-titleabbrev">
       subscriber_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
				BEGIN
					UPDATE distribution.subscriber SET
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry)
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				</programlisting>
      </para>
    </section>

<!-- Function table_fields(character varying) -->
    <section id="distribution.function.table-fields-character-varying"
             xreflabel="distributiontable_fields(character varying)">
      <title id="distribution.function.table-fields-character-varying-title">
       table_fields(character varying)
      </title>
      <titleabbrev id="distribution.function.table-fields-character-varying-titleabbrev">
       table_fields(character varying)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
	DECLARE
		ftable ALIAS FOR $1;
		result text;
	BEGIN
		SELECT distribution.table_fields(ftable,&#39;&#39;&#39;&#39;) INTO result;
		RETURN result;
	END			;
</programlisting>
      </para>
    </section>

<!-- Function table_fields(exclude character varying,  character varying[]) -->
    <section id="distribution.function.table-fields-exclude-character-varying-character-varyingARRAY"
             xreflabel="distributiontable_fields(exclude character varying,  character varying[])">
      <title id="distribution.function.table-fields-exclude-character-varying-character-varyingARRAY-title">
       table_fields(exclude character varying,  character varying[])
      </title>
      <titleabbrev id="distribution.function.table-fields-exclude-character-varying-character-varyingARRAY-titleabbrev">
       table_fields(exclude character varying,  character varying[])
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns field names from a table.
        <programlisting>
	DECLARE
		ftable ALIAS FOR $1;
		result text;
	BEGIN
		SELECT
			string_agg(pg_attribute.attname , &#39;&#39;, &#39;&#39;) INTO result
		FROM
			pg_class, pg_attribute
		WHERE
			pg_class.relname = ftable 
			AND pg_class.oid = pg_attribute.attrelid 
			AND pg_attribute.attnum &gt; 0
			AND pg_attribute.attname != all(exclude)
		;
		RETURN result;
	END
</programlisting>
      </para>
    </section>

<!-- Function valve_geom() -->
    <section id="distribution.function.valve-geom"
             xreflabel="distributionvalve_geom()">
      <title id="distribution.function.valve-geom-title">
       valve_geom()
      </title>
      <titleabbrev id="distribution.function.valve-geom-titleabbrev">
       valve_geom()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
				BEGIN
					UPDATE distribution.valve SET
						id_district        = distribution.get_district_id(NEW.geometry),
						id_pressurezone    = distribution.get_pressurezone_id(NEW.geometry),
						id_printmap        = distribution.get_printmap_id(NEW.geometry),
						geometry_schematic = NEW.geometry,
			
						_printmaps         = distribution.get_printmaps(NEW.geometry),
						_districts         = distribution.get_districts(NEW.geometry)
						WHERE id = NEW.id ;
					RETURN NEW;				
				END;
				</programlisting>
      </para>
    </section>

  </chapter>

</book>

